"use strict";angular.module("gestigris-common",["ngAnimate","ngSanitize","ngMessages","ui.router","ngMaterial","leseulsteve.angular-mongoose","leseulsteve.angular-user-auth","pascalprecht.translate","leaflet-directive","btford.socket-io"]),angular.module("gestigris-common").config(["$urlRouterProvider","$httpProvider",function(a,b){a.otherwise("/"),b.interceptors.push(function(){return{request:function(a){if(!_.endsWith(a.url,".html")&&!_.endsWith(a.url,".json")&&!_.startsWith(a.url,"http")){var b="http://localhost:9011";if(!_.startsWith(a.url,"photon")){var c=a.url.split("/")[a.url.split("/").length-2];_.includes(["img","icons","/"],c)||_.endsWith(a.url,"md-close.svg")||_.endsWith(a.url,"md-tabs-arrow.svg")||(b+="/api/v1",a.url=b+"/"+a.url)}}return a}}})}]),angular.module("gestigris-common").run(["$rootScope","$mdMedia",function(a,b){a.$mdMedia=b,a._=window._,a.$on("$stateChangeSuccess",function(){document.body.scrollTop=document.documentElement.scrollTop=0}),a.$on("$stateChangeError",function(a,b,c,d,e,f){console.error("$stateChangeError: ",b,f)}),a.$on("$stateChangeStart",function(){a.loadingRoute=!0}),a.$on("$stateChangeSuccess",function(){a.loadingRoute=!1})}]),angular.module("gestigris-common").config(["$translateProvider",function(a){a.useStaticFilesLoader({prefix:"translations/locale-",suffix:".json"}),a.preferredLanguage("fr_CA")}]),angular.module("gestigris-common").directive("grisLogo",function(){return{restrict:"E",template:'<img src="img/509ceaee.logopng.png alt="Logo Gris-Québec"/>'}}),angular.module("gestigris-common").factory("Arrondissement",["Schema",function(a){var b=new a("adresse/arrondissement");return b.prototype.toString=function(){return this.name},b}]),angular.module("gestigris-common").service("Moment",function(){return moment.locale("ca-fr"),moment}),angular.module("gestigris-common").factory("Pays",["$q",function(a){var b=function(a){_.assign(this,a)};return b.prototype.toString=function(){return this.name},b.find=function(){var c=a.defer();return c.resolve(_.map([{_id:"578bc96bd8916725bb4df182",name:"Canada"}],function(a){return new b(a)})),c.promise},b}]),angular.module("gestigris-common").factory("Province",["$q",function(a){var b=function(a){_.assign(this,a)};return b.prototype.toString=function(){return this.name},b.find=function(){var c=a.defer();return c.resolve(_.map([{_id:"578bc96bd8916725bb4df181",name:"Québec"}],function(a){return new b(a)})),c.promise},b}]),angular.module("gestigris-common").service("Toast",["$mdMedia","$mdToast",function(a,b){var c=function(b){this.position=a("sm")?"bottom fit":"bottom right",_.isString(b)?this.template="<md-toast>"+b+"</md-toast>":_.assign(this,b)};return c.prototype.show=function(){b.show(this)},c}]),angular.module("gestigris-common").factory("Ville",["$q",function(a){var b=function(a){_.assign(this,a)};return b.prototype.toString=function(){return this.name},b.find=function(){var c=a.defer();return c.resolve(_.map([{_id:"578bc96bd8916725bb5df181",name:"Ville de Québec"}],function(a){return new b(a)})),c.promise},b}]),angular.module("gestigris-common").directive("etablissementImage",["Etablissement",function(a){var b={};return{restrict:"E",templateUrl:"modules/etablissements/views/etablissement.image.html",link:function(c,d,e){function f(){if(c.image=c.etablissement.getImageUrl(),c.image){var a=d.find("img");a.bind("load",function(){c.$broadcast("imageLoaded"),c.$apply()})}else c.$broadcast("imageLoaded")}c.$watch(e.etablissementId,function(d){_.isUndefined(d)||(c.etablissement=b[d],_.isUndefined(c.etablissement)?a.findById(d).then(function(a){c.etablissement=a,f(),b[d]=a}):f())}),c.$watch(e.etablissement,function(a){_.isUndefined(a)||(b[a._id]=a,f())})}}}]),angular.module("gestigris-common").directive("etablissementMap",function(){return{restrict:"E",scope:!0,replace:!0,templateUrl:"modules/etablissements/views/etablissement.map.html",link:function(a,b,c){a.$watch(c.etablissement,function(b){_.isUndefined(b.coordinates)||angular.extend(a,{center:{lat:b.coordinates.lat,lng:b.coordinates["long"],zoom:15},markers:{etablissement:{lat:b.coordinates.lat,lng:b.coordinates["long"],message:b.address.street,focus:!0,draggable:!1}}})},!0)}}}),angular.module("gestigris-common").factory("EtablissementType",["Schema",function(a){var b=new a("etablissement-type");return b.prototype.toString=function(){return this.name},b}]),angular.module("gestigris-common").factory("Etablissement",["Schema",function(a){var b=new a("etablissement");return b.prototype.toString=function(){return this.name},b.prototype.getImageUrl=function(){return this.imageUrl},b}]),angular.module("gestigris-common").config(["$mdIconProvider",function(a){a.iconSet("action","icons/99632812.action-icons.svg",24).iconSet("alert","icons/3d062121.alert-icons.svg",24).iconSet("av","icons/12727965.av-icons.svg",24).iconSet("communication","icons/14a6ec88.communication-icons.svg",24).iconSet("content","icons/d73de9e3.content-icons.svg",24).iconSet("device","icons/98f8d921.device-icons.svg",24).iconSet("editor","icons/bbf5607a.editor-icons.svg",24).iconSet("file","icons/96f6b24b.file-icons.svg",24).iconSet("hardware","icons/90548e26.hardware-icons.svg",24).iconSet("icons","icons/icons-icons.svg",24).iconSet("image","icons/a0577dd0.image-icons.svg",24).iconSet("maps","icons/ea99afd9.maps-icons.svg",24).iconSet("navigation","icons/9edaa8f8.navigation-icons.svg",24).iconSet("notification","icons/80d43d2a.notification-icons.svg",24).iconSet("social","icons/39ce2056.social-icons.svg",24).iconSet("toggle","icons/a0cd50cd.toggle-icons.svg",24)}]),angular.module("gestigris-common").config(["$mdThemingProvider",function(a){var b=a.extendPalette("green",{500:"859D47"}),c=a.extendPalette("orange",{A200:"F26533"}),d=a.extendPalette("red",{500:"EC2F58"});a.definePalette("vertGris",b),a.definePalette("orangeGris",c),a.definePalette("redGris",d),a.theme("default").primaryPalette("vertGris").accentPalette("orangeGris").warnPalette("redGris")}]),angular.module("gestigris-common").config(["$stateProvider",function(a){a.state("login",{url:"/connexion",templateUrl:"modules/users/views/login.form.html",controller:"LoginController",controllerAs:"loginCtrl"})}]),angular.module("gestigris-common").controller("LoginController",["$scope","$state",function(a,b){this.handleLogin=function(b,c){a.signin(b,c)},this.handleLogedIn=function(){b.go("interventions")}}]),angular.module("gestigris-common").directive("avatar",["$mdDialog",function(a){return{restrict:"E",scope:{user:"="},templateUrl:"modules/users/views/avatar.html",compile:function(b,c){return b.addClass("md-whiteframe-3dp"),_.isUndefined(c.clickToUpdate)||(b.append('<input style="display:none;" type="file"/>'),b.append('<div class="md-caption text-center">Cliquez pour changer</div>'),b.css("cursor","pointer")),function(b,d){if(b.$watch("user",function(a){a&&(b.hasImage=!_.isUndefined(a.avatar))},!0),!_.isUndefined(c.clickToUpdate)){var e=d.find("input");d.bind("click",function(){e[0].click()}),e.bind("change",function(c){var d=new FileReader;b.myImage="",b.myCroppedImage="",d.onload=function(c){b.$apply(function(){b.myImage=c.target.result}),a.show({templateUrl:"modules/users/views/avatar.dialog.html",parent:angular.element(document.body),targetEvent:c,scope:b,preserveScope:!0}),b.change=function(){b.user.avatar=b.myCroppedImage,b.user.save().then(function(c){a.hide(),_.assign(b.user,c)})},b.cancel=function(){a.hide()}},d.readAsDataURL(c.currentTarget.files[0])})}}}}}]),angular.module("gestigris-common").run(["$templateCache",function(a){a.put("modules/etablissements/views/etablissement.image.html",'<img ng-show=image ng-src="{{ image }}" alt="{{ etablissement.toString() }}" style=height:200px><div ng-show=!image layout=column layout-align="center center" style=height:200px><p class=md-headline style="text-align: center">{{ etablissement.toString() }}</p></div>'),a.put("modules/etablissements/views/etablissement.map.html","<leaflet ng-if=center markers=markers lf-center=center></leaflet>"),a.put("modules/users/views/avatar.html",'<div><md-icon ng-if=!hasImage md-svg-icon=action:face alt=user.toString()><md-tooltip ng-if="user._id !== currentUser._id">{{ user.toString() }}</md-tooltip></md-icon><div ng-if=hasImage><img ng-src="{{ user.avatar }}" alt="{{ user.toString() }}"><md-tooltip ng-if="user._id !== currentUser._id">{{ user.toString() }}</md-tooltip></div></div>'),a.put("modules/users/views/login.form.html",'<md-card login signin-form flex layout-padding><form name=loginForm novalidate ng-submit="loginCtrl.handleLogin(loginForm, credentials)"><md-card-title><md-card-title-text><span class=md-headline>Interventions</span> <span class=md-subhead>Beta 1</span><div style=margin-top:50px><md-input-container class="md-icon-float md-block" md-is-error="loginForm.$submitted && (loginForm.userName.$error.required || loginForm.userName.$error.email)"><label translate=LOGIN_FORM.EMAIL.DESCRIPTION></label><md-icon md-svg-icon=communication:mail_outline></md-icon><input flex type=email name=userName required ng-focus=loginForm.$setPristine() ng-model=credentials.username><div ng-messages=loginForm.userName.$error><div ng-message=required><span translate=LOGIN_FORM.EMAIL.ERRORS.REQUIRED></span></div><div ng-message=email><span translate=LOGIN_FORM.EMAIL.ERRORS.INVALID></span></div></div></md-input-container><md-input-container class="md-icon-float md-block" ng-hide=isResetingPassword md-is-error="loginForm.$submitted && loginForm.password.$error.required"><label translate=LOGIN_FORM.PASSWORD.DESCRIPTION></label><md-icon md-svg-icon=action:lock_outline></md-icon><input flex type=password name=password ng-required=!isResetingPassword ng-model=credentials.password><div ng-messages=loginForm.password.$error ng-show="loginForm.password.$touched || loginForm.$submitted"><div ng-message=required><span translate=LOGIN_FORM.PASSWORD.ERRORS.REQUIRED></span></div></div></md-input-container><div ng-show="isResetingPassword && loginForm.$submitted && loginForm.$valid">{{ passwordResetMessage }}</div></div></md-card-title-text><md-card-title-media><div class="md-media-lg card-media" style=width:250px><gris-logo></gris-logo></div></md-card-title-media></md-card-title><md-card-actions layout=row layout-align="end center"><md-button flex=33 class="md-raised md-primary" flex type=submit ng-disabled=isResetingPassword aria-label="{{\'LOGIN_FORM.BUTTONS.SIGN_IN\' | translate}}" translate=LOGIN_FORM.BUTTONS.SIGN_IN></md-button></md-card-actions></form></md-card>')}]);